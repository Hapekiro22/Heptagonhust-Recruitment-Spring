=============== 环境信息 ===============
hepnode1
Thu Mar 27 05:18:17 PM CST 2025
CUDA 库路径: /usr/local/cuda/targets/x86_64-linux/lib:

=============== 基本 CUDA 功能测试 ===============
========= CUDA 基础功能测试 =========
检测到 1 个 CUDA 设备
设备 0: NVIDIA L40
  计算能力: 8.9
  全局内存: 44.64 GB
  多处理器数量: 142
  时钟频率: 2490 MHz
  显存总线宽度: 384 bits
CUDA 内核错误: the provided PTX was compiled with an unsupported toolchain.

=============== cuBLAS 矩阵乘法测试 ===============
========= cuBLAS 矩阵乘法测试 =========
CUDA 内存: 总计 44.64 GB, 可用 44.22 GB

测试矩阵大小: 32 x 32
矩阵 A (32x32):
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
...

矩阵 B (32x32):
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
    1.00     1.00     1.00     1.00     1.00     1.00 ...
...

执行 cublasSgemm (N=32)...
结果矩阵 C (32x32):
   32.00    32.00    32.00    32.00    32.00    32.00 ...
   32.00    32.00    32.00    32.00    32.00    32.00 ...
   32.00    32.00    32.00    32.00    32.00    32.00 ...
   32.00    32.00    32.00    32.00    32.00    32.00 ...
   32.00    32.00    32.00    32.00    32.00    32.00 ...
   32.00    32.00    32.00    32.00    32.00    32.00 ...
...

矩阵乘法验证通过 (N=32)！

测试矩阵大小: 256 x 256
执行 cublasSgemm (N=256)...
矩阵乘法验证通过 (N=256)！

测试矩阵大小: 1024 x 1024
执行 cublasSgemm (N=1024)...
矩阵乘法验证通过 (N=1024)！

测试矩阵大小: 4096 x 4096
执行 cublasSgemm (N=4096)...
矩阵乘法验证通过 (N=4096)！

cuBLAS 测试完成!

=============== 特定 sgemm_cublas 函数测试 ===============
========= 测试你的 sgemm_cublas 函数 =========


===== 测试 1: M=16, N=16, K=16 =====
矩阵 A (16x16):
    0.83     0.86     0.77     0.15     0.93     0.35 ...
    0.40     0.26     0.72     0.36     0.11     0.68 ...
    0.22     0.58     0.69     0.67     0.93     0.56 ...
    0.15     0.70     0.13     0.26     0.91     0.80 ...
    0.36     0.05     0.46     0.29     0.13     0.57 ...
    0.87     0.08     0.76     0.78     0.88     0.84 ...
...
矩阵 B (16x16):
    0.20     0.36     0.44     0.26     0.22     0.65 ...
    0.52     0.99     0.79     0.50     0.68     0.71 ...
    0.99     0.96     0.59     0.73     0.13     0.68 ...
    0.36     0.07     0.45     0.56     0.79     0.18 ...
    0.06     0.01     0.13     0.72     0.21     0.55 ...
    0.27     0.50     0.84     0.58     0.20     0.24 ...
...
执行 GPU 矩阵乘法...
sgemm_cublas: M=16, N=16, K=16
初始化 cuBLAS...
找到 1 个 CUDA 设备
成功设置 CUDA 设备 0
成功创建 cuBLAS 句柄
内存要求: 0.00 MB, 可用: 45266.25 MB
正在分配 GPU 内存...
d_A 分配成功
d_B 分配成功
d_C 分配成功
正在复制数据到 GPU...
正在执行 cublasSgemm (原始参数)...
cublasSgemm 执行成功，正在复制结果回主机...
复制完成，正在释放 GPU 内存...
GPU 内存释放成功
执行 CPU 矩阵乘法...
GPU 结果 (16x16):
    3.07     6.42     7.01     4.10     2.97     5.37 ...
    2.74     4.45     4.84     2.93     2.16     4.08 ...
    2.85     5.41     5.39     3.55     2.42     4.91 ...
    2.92     5.85     5.71     3.82     2.61     4.75 ...
    2.70     4.62     4.69     2.69     2.66     4.64 ...
    3.56     5.67     6.06     3.86     3.03     5.55 ...
...
CPU 结果 (16x16):
    3.07     2.74     2.85     2.92     2.70     3.56 ...
    6.42     4.45     5.41     5.85     4.62     5.67 ...
    7.01     4.84     5.39     5.71     4.69     6.06 ...
    4.10     2.93     3.55     3.82     2.69     3.86 ...
    2.97     2.16     2.42     2.61     2.66     3.03 ...
    5.37     4.08     4.91     4.75     4.64     5.55 ...
...
不匹配: C_gpu[1] = 6.424500, C_cpu[1] = 2.737100
不匹配: C_gpu[2] = 7.006399, C_cpu[2] = 2.853100
不匹配: C_gpu[3] = 4.096100, C_cpu[3] = 2.921300
不匹配: C_gpu[4] = 2.970900, C_cpu[4] = 2.697400
不匹配: C_gpu[5] = 5.371600, C_cpu[5] = 3.557000
不匹配: C_gpu[6] = 4.571000, C_cpu[6] = 3.015800
不匹配: C_gpu[7] = 6.422999, C_cpu[7] = 3.237400
不匹配: C_gpu[8] = 3.893200, C_cpu[8] = 2.399700
不匹配: C_gpu[9] = 4.585600, C_cpu[9] = 2.520600
不匹配: C_gpu[10] = 5.578200, C_cpu[10] = 3.079600
验证失败: 发现 240 个不匹配的元素 (总共 256 个)

===== 测试 2: M=64, N=64, K=64 =====
执行 GPU 矩阵乘法...
sgemm_cublas: M=64, N=64, K=64
初始化 cuBLAS...
内存要求: 0.05 MB, 可用: 45266.25 MB
正在分配 GPU 内存...
d_A 分配成功
d_B 分配成功
d_C 分配成功
正在复制数据到 GPU...
正在执行 cublasSgemm (原始参数)...
cublasSgemm 执行成功，正在复制结果回主机...
复制完成，正在释放 GPU 内存...
GPU 内存释放成功
执行 CPU 矩阵乘法...
不匹配: C_gpu[1] = 15.688902, C_cpu[1] = 18.267401
不匹配: C_gpu[2] = 14.540299, C_cpu[2] = 19.084898
不匹配: C_gpu[3] = 16.867598, C_cpu[3] = 17.401598
不匹配: C_gpu[4] = 13.915503, C_cpu[4] = 19.191601
不匹配: C_gpu[5] = 15.338002, C_cpu[5] = 17.141500
不匹配: C_gpu[6] = 14.401402, C_cpu[6] = 17.763399
不匹配: C_gpu[7] = 16.332802, C_cpu[7] = 19.036697
不匹配: C_gpu[8] = 16.202900, C_cpu[8] = 19.715899
不匹配: C_gpu[9] = 15.668300, C_cpu[9] = 18.783205
不匹配: C_gpu[10] = 15.861399, C_cpu[10] = 18.647697
验证失败: 发现 4030 个不匹配的元素 (总共 4096 个)

===== 测试 3: M=128, N=128, K=128 =====
执行 GPU 矩阵乘法...
sgemm_cublas: M=128, N=128, K=128
初始化 cuBLAS...
内存要求: 0.19 MB, 可用: 45266.25 MB
正在分配 GPU 内存...
d_A 分配成功
d_B 分配成功
d_C 分配成功
正在复制数据到 GPU...
正在执行 cublasSgemm (原始参数)...
cublasSgemm 执行成功，正在复制结果回主机...
复制完成，正在释放 GPU 内存...
GPU 内存释放成功
执行 CPU 矩阵乘法...
不匹配: C_gpu[1] = 33.157299, C_cpu[1] = 28.988605
不匹配: C_gpu[2] = 31.812798, C_cpu[2] = 30.448992
不匹配: C_gpu[3] = 31.866901, C_cpu[3] = 31.795702
不匹配: C_gpu[4] = 32.795399, C_cpu[4] = 30.514099
不匹配: C_gpu[5] = 34.562698, C_cpu[5] = 30.541500
不匹配: C_gpu[6] = 32.126701, C_cpu[6] = 29.343903
不匹配: C_gpu[7] = 31.859798, C_cpu[7] = 27.747898
不匹配: C_gpu[8] = 31.990402, C_cpu[8] = 29.868399
不匹配: C_gpu[9] = 34.363899, C_cpu[9] = 32.309105
不匹配: C_gpu[10] = 35.721798, C_cpu[10] = 30.357702
验证失败: 发现 16246 个不匹配的元素 (总共 16384 个)

===== 测试 4: M=256, N=256, K=256 =====
执行 GPU 矩阵乘法...
sgemm_cublas: M=256, N=256, K=256
初始化 cuBLAS...
内存要求: 0.75 MB, 可用: 45266.25 MB
正在分配 GPU 内存...
d_A 分配成功
d_B 分配成功
d_C 分配成功
正在复制数据到 GPU...
正在执行 cublasSgemm (原始参数)...
cublasSgemm 执行成功，正在复制结果回主机...
复制完成，正在释放 GPU 内存...
GPU 内存释放成功
执行 CPU 矩阵乘法...
不匹配: C_gpu[1] = 65.072403, C_cpu[1] = 57.608288
不匹配: C_gpu[2] = 64.616501, C_cpu[2] = 62.270306
不匹配: C_gpu[3] = 64.980499, C_cpu[3] = 58.598480
不匹配: C_gpu[4] = 62.661396, C_cpu[4] = 68.935402
不匹配: C_gpu[5] = 61.859001, C_cpu[5] = 64.821693
不匹配: C_gpu[6] = 63.726398, C_cpu[6] = 60.040520
不匹配: C_gpu[7] = 66.186897, C_cpu[7] = 65.115295
不匹配: C_gpu[8] = 64.771301, C_cpu[8] = 60.233688
不匹配: C_gpu[9] = 62.207600, C_cpu[9] = 60.935905
不匹配: C_gpu[10] = 66.143295, C_cpu[10] = 65.285492
验证失败: 发现 65275 个不匹配的元素 (总共 65536 个)

===== 测试 5: M=512, N=512, K=512 =====
执行 GPU 矩阵乘法...
sgemm_cublas: M=512, N=512, K=512
初始化 cuBLAS...
内存要求: 3.00 MB, 可用: 45266.25 MB
正在分配 GPU 内存...
d_A 分配成功
d_B 分配成功
d_C 分配成功
正在复制数据到 GPU...
正在执行 cublasSgemm (原始参数)...
cublasSgemm 执行成功，正在复制结果回主机...
复制完成，正在释放 GPU 内存...
GPU 内存释放成功
执行 CPU 矩阵乘法...
不匹配: C_gpu[1] = 125.180710, C_cpu[1] = 124.612259
不匹配: C_gpu[2] = 126.656113, C_cpu[2] = 127.762688
不匹配: C_gpu[3] = 128.142609, C_cpu[3] = 127.648392
不匹配: C_gpu[4] = 127.026993, C_cpu[4] = 123.304222
不匹配: C_gpu[5] = 131.314102, C_cpu[5] = 125.855690
不匹配: C_gpu[6] = 129.101486, C_cpu[6] = 128.734360
不匹配: C_gpu[7] = 130.205002, C_cpu[7] = 129.011963
不匹配: C_gpu[8] = 126.090309, C_cpu[8] = 131.936203
不匹配: C_gpu[9] = 127.878906, C_cpu[9] = 124.980537
不匹配: C_gpu[10] = 130.016968, C_cpu[10] = 126.695900
验证失败: 发现 261611 个不匹配的元素 (总共 262144 个)

测试完成!

所有测试完成！
